#include <Arduino.h>
#include "json_serializer.h"

MeterPayload payload;
char json[512];

void setup() {
    Serial.begin(115200);
    while (!Serial);

    memset(&payload, 0, sizeof(payload));

    strcpy(payload.meta.gatewayId, "gateway_1234");
    strcpy(payload.meta.date, "1970-01-01");
    strcpy(payload.meta.deviceType, "stromleser");
    payload.meta.interval_minutes = 15;
    payload.meta.total_readings = 1;

    payload.values.device_count = 1;

    strcpy(payload.values.readings[0].media, "water");
    strcpy(payload.values.readings[0].meter, "waterstarm");
    strcpy(payload.values.readings[0].deviceId, "stromleser_50898527");
    strcpy(payload.values.readings[0].unit, "m3");

    strcpy(payload.values.readings[0].data[0].timestamp, "1970-01-01 00:00");
    strcpy(payload.values.readings[0].data[0].meter_datetime, "1970-01-01 00:00");
    payload.values.readings[0].data[0].total_m3 = 107.752f;
    strcpy(payload.values.readings[0].data[0].status, "OK");

    serialize_to_json(&payload, json, sizeof(json));
    Serial.println(json);
}

void loop() {}
